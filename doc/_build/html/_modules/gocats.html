<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>gocats &#8212; GOcats 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="top" title="GOcats 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>GOcats 1.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>gocats</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <h1>Source code for gocats</h1><div class="highlight"><pre>
<span></span><span class="c1"># !/usr/bin/python3</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The Gene Ontology Categories Suite (GOcats)</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">This module provides methods for the creation of directed acyclic concept subgraphs of Gene Ontology, along with methods</span>
<span class="sd">for evaluating those subgraphs.</span>

<span class="sd">Command line implementation::</span>

<span class="sd">    Usage:</span>
<span class="sd">        gocats create_subgraphs &lt;database_file&gt; &lt;keyword_file&gt; &lt;output_directory&gt; [--supergraph_namespace=&lt;None&gt; --subgraph_namespace=&lt;None&gt; --supergraph_relationships=[] --subgraph_relationships=[] --map_supersets --output_termlist --test_subgraph=&lt;None&gt;]</span>
<span class="sd">        gocats compute_subgraph_intersection &lt;gocats_mapping&gt; &lt;uniprot_mapping&gt; &lt;map2slim_mapping&gt; &lt;output_directory&gt; [--inclusion_index --id_translation=&lt;filename&gt;]</span>
<span class="sd">        gocats compute_subgraph_similarity &lt;gocats_mapping&gt; &lt;other_mapping&gt; &lt;output_directory&gt; &lt;filename&gt; [--id_translation=&lt;filename&gt;]</span>
<span class="sd">        gocats categorize_dataset &lt;gaf_dataset&gt; &lt;term_mapping&gt; &lt;output_directory&gt; &lt;GAF_name&gt;</span>
<span class="sd">        gocats compare_mapping &lt;mapped_gaf&gt; &lt;manual_dataset&gt;  [--map_manual_dataset=&lt;filename&gt; --save_assignments=&lt;filename&gt; --id_translation=&lt;filename&gt;]</span>
<span class="sd">    Options:</span>
<span class="sd">        -h --help                            Shows this screen.</span>
<span class="sd">        --version                            Shows version.</span>
<span class="sd">        --supergraph_namespace=&lt;None&gt;        Filters the supergraph to a given namespace.</span>
<span class="sd">        --subgraph_namespace=&lt;None&gt;          Filters the subgraph to a given namespace.</span>
<span class="sd">        --supergraph_relationships=[]        A provided list will denote which relationships are allowed in the supergraph.</span>
<span class="sd">        --subgraph_relationships=[]          A provided list will denote which relationships are allowed in the subgraph.</span>
<span class="sd">        --map_supersets                      Maps all terms to all root nodes, regardless of if a root node supercedes another.</span>
<span class="sd">        --output_termlist                    Outputs a list of all terms in the supergraph as a JsonPickle file in the output directory.</span>
<span class="sd">        --test_subgraph=&lt;None&gt;               Enter a GO ID to output information describing the mapping differences between GOcats and Map2Slim.</span>
<span class="sd">        --inclusion_index                    Calculates inclusion index of terms between categories among separate mapping sources.</span>
<span class="sd">        --save_assignments=&lt;filename&gt;        Save a file with all genes and their GO assignments.</span>
<span class="sd">        --id_translation=&lt;filename&gt;          Specify an id_translation file to associate go terms with their English names.</span>
<span class="sd">        --map_manual_dataset=&lt;filename&gt;      Specify a mapping file to map manual dataset annotations to the user-specified categories.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">ontologyparser</span>
<span class="kn">import</span> <span class="nn">godag</span>
<span class="kn">import</span> <span class="nn">subdag</span>
<span class="kn">import</span> <span class="nn">docopt</span>
<span class="kn">import</span> <span class="nn">tools</span>
<span class="kn">import</span> <span class="nn">version</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;create_subgraphs&#39;</span><span class="p">]:</span>
        <span class="n">create_subgraphs</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;compute_subgraph_intersection&#39;</span><span class="p">]:</span>
        <span class="n">compute_subgraph_intersection</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;compute_subgraph_similarity&#39;</span><span class="p">]:</span>
        <span class="n">compute_subgraph_similarity</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;categorize_dataset&#39;</span><span class="p">]:</span>
        <span class="n">categorize_dataset</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;compare_mapping&#39;</span><span class="p">]:</span>
        <span class="n">compare_mapping</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>


<span class="c1"># Need a SubGraphCollection object</span>
<div class="viewcode-block" id="build_graph"><a class="viewcode-back" href="../api.html#gocats.build_graph">[docs]</a><span class="k">def</span> <span class="nf">build_graph</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;**Not yet implemented**</span>

<span class="sd">    Try build_graph_interpreter to create a GO graph object to explore within a Python</span>
<span class="sd">    interpreter.&quot;&quot;&quot;</span>
    <span class="c1"># FIXME: JsonPickle is reaching max recusion depth because of the fact that objects point to one another.</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_namespace&#39;</span><span class="p">]:</span>
        <span class="n">supergraph_namespace</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_namespace&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">supergraph_namespace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--allowed_relationships&#39;</span><span class="p">]:</span>
        <span class="n">allowed_relationships</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--allowed_relationships&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">allowed_relationships</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">database</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_file&gt;&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
    <span class="n">database_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_file&gt;&#39;</span><span class="p">])</span>
    <span class="n">graph_class</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;go.obo&#39;</span><span class="p">:</span> <span class="n">godag</span><span class="o">.</span><span class="n">GoGraph</span><span class="p">(</span><span class="n">supergraph_namespace</span><span class="p">,</span> <span class="n">allowed_relationships</span><span class="p">)}</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">graph_class</span><span class="p">[</span><span class="n">database_name</span><span class="p">]</span>
    <span class="n">parsing_class</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;go.obo&#39;</span><span class="p">:</span> <span class="n">ontologyparser</span><span class="o">.</span><span class="n">GoParser</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">graph</span><span class="p">)}</span>
    <span class="n">parsing_class</span><span class="p">[</span><span class="n">database_name</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>

    <span class="n">database</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># print(&quot;JsonPickle saving GO object&quot;)</span>
    <span class="c1"># tools.json_save(graph, os.path.join(output_directory, &quot;{}_{}&quot;.format(database_name[:-4], date.today())))</span>


<div class="viewcode-block" id="build_graph_interpreter"><a class="viewcode-back" href="../api.html#gocats.build_graph_interpreter">[docs]</a><span class="k">def</span> <span class="nf">build_graph_interpreter</span><span class="p">(</span><span class="n">database_file</span><span class="p">,</span> <span class="n">supergraph_namespace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allowed_relationships</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a graph object of GO, which can be traversed and queried within a Python interpreter.</span>

<span class="sd">    :param filehandle: Ontology database file.</span>
<span class="sd">    :param str supergraph_namespace: Optional - Filter graph to a sub-ontology namespace.</span>
<span class="sd">    :param list allowed_relationships: Optional - Filter graph to use only those relationships listed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">database_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="n">godag</span><span class="o">.</span><span class="n">GoGraph</span><span class="p">(</span><span class="n">supergraph_namespace</span><span class="p">,</span> <span class="n">allowed_relationships</span><span class="p">)</span>
    <span class="n">go_parser</span> <span class="o">=</span> <span class="n">ontologyparser</span><span class="o">.</span><span class="n">GoParser</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">graph</span><span class="p">)</span>
    <span class="n">go_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
    <span class="n">database</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">graph</span></div>


<div class="viewcode-block" id="create_subgraphs"><a class="viewcode-back" href="../api.html#gocats.create_subgraphs">[docs]</a><span class="k">def</span> <span class="nf">create_subgraphs</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a graph object of GO and then extracts subgraphs which represent concepts that are defined by a list of</span>
<span class="sd">    provided keywords.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_namespace&#39;</span><span class="p">]:</span>
        <span class="n">supergraph_namespace</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_namespace&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">supergraph_namespace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--subgraph_namespace&#39;</span><span class="p">]:</span>
        <span class="n">subgraph_namespace</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--subgraph_namespace&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subgraph_namespace</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_relationships&#39;</span><span class="p">]:</span>
        <span class="n">supergraph_relationships</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--supergraph_relationships&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">supergraph_relationships</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--subgraph_relationships&#39;</span><span class="p">]:</span>
        <span class="n">subgraph_relationships</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--subgraph_relationships&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">subgraph_relationships</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Building the supergraph</span>
    <span class="n">database</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_file&gt;&#39;</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
    <span class="n">database_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;database_file&gt;&#39;</span><span class="p">])</span>
    <span class="n">graph_class</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;go.obo&#39;</span><span class="p">:</span> <span class="n">godag</span><span class="o">.</span><span class="n">GoGraph</span><span class="p">(</span><span class="n">supergraph_namespace</span><span class="p">,</span> <span class="n">supergraph_relationships</span><span class="p">)}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">supergraph</span> <span class="o">=</span> <span class="n">graph_class</span><span class="p">[</span><span class="n">database_name</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The provided ontology filename was not reconized. Please do not rename ontology files. The accepted list of filenames are as follows: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">graph_class</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="n">parsing_class</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;go.obo&#39;</span><span class="p">:</span> <span class="n">ontologyparser</span><span class="o">.</span><span class="n">GoParser</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">supergraph</span><span class="p">)}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">parsing_class</span><span class="p">[</span><span class="n">database_name</span><span class="p">]</span><span class="o">.</span><span class="n">parse</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The provided ontology filename was not reconized. Please do not rename ontology files. The accepted list of filenames are as follows: </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">graph_class</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--output_termlist&#39;</span><span class="p">]:</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">json_save</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">supergraph</span><span class="o">.</span><span class="n">id_index</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s2">&quot;termlist&quot;</span><span class="p">))</span>

    <span class="n">id_translation</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">supergraph</span><span class="o">.</span><span class="n">id_index</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">id_translation</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">json_save</span><span class="p">(</span><span class="n">id_translation</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s2">&quot;id_translation&quot;</span><span class="p">))</span>

    <span class="n">database</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Building and collecting subgraphs</span>
    <span class="n">subgraph_collection</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;keyword_file&gt;&#39;</span><span class="p">],</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
            <span class="n">subgraph_name</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">keyword_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">keyword</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="n">subgraph_collection</span><span class="p">[</span><span class="n">subgraph_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdag</span><span class="o">.</span><span class="n">SubGraph</span><span class="o">.</span><span class="n">from_filtered_graph</span><span class="p">(</span><span class="n">supergraph</span><span class="p">,</span> <span class="n">keyword_list</span><span class="p">,</span> <span class="n">subgraph_namespace</span><span class="p">,</span> <span class="n">subgraph_relationships</span><span class="p">)</span>

    <span class="c1"># Handling superset mapping</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--map_supersets&#39;</span><span class="p">]:</span>
        <span class="n">category_subsets</span> <span class="o">=</span> <span class="n">find_category_subsets</span><span class="p">(</span><span class="n">subgraph_collection</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NOTE: supersets were mapped.&quot;</span><span class="p">)</span>
        <span class="n">category_subsets</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">collection_id_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">collection_node_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">collection_content_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">subgraph</span> <span class="ow">in</span> <span class="n">subgraph_collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">rep_node</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">root_id_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">collection_id_mapping</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">([</span><span class="n">rep_node</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">collection_id_mapping</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">rep_node</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">rep_node</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">root_node_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">collection_node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rep_node</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">collection_node_mapping</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">rep_node</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">rep_node</span><span class="p">,</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">content_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">collection_content_mapping</span><span class="p">[</span><span class="n">rep_node</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>

    <span class="c1"># Remove root nodes that are subsets of existing root nodes from mapping</span>
    <span class="k">if</span> <span class="n">category_subsets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">root_id_list</span> <span class="ow">in</span> <span class="n">collection_id_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">subset_id</span><span class="p">,</span> <span class="n">superset_ids</span> <span class="ow">in</span> <span class="n">category_subsets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">subset_id</span> <span class="ow">in</span> <span class="n">root_id_list</span><span class="p">:</span>
                    <span class="p">[</span><span class="n">root_id_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">superset_ids</span> <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root_id_list</span><span class="p">]</span>
    <span class="c1"># TODO: do the same for node_object_mapping</span>

    <span class="c1"># Save mapping files and create report</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">json_save</span><span class="p">(</span><span class="n">collection_id_mapping</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s2">&quot;GC_id_mapping&quot;</span><span class="p">))</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">json_save</span><span class="p">(</span><span class="n">collection_content_mapping</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s2">&quot;GC_content_mapping&quot;</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="s1">&#39;subgraph_report.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">report_file</span><span class="p">:</span>
        <span class="n">report_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;Subgraph data</span><span class="se">\n</span><span class="s1">Supergraph filter: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Subgraph filter: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">GO terms in the supergraph: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">GO terms in subgraphs: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Relationship prevalence: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">supergraph_namespace</span><span class="p">,</span> <span class="n">subgraph_namespace</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">supergraph</span><span class="o">.</span><span class="n">node_list</span><span class="p">)),</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">collection_id_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())),</span> <span class="n">supergraph</span><span class="o">.</span><span class="n">relationship_count</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">subgraph_name</span><span class="p">,</span> <span class="n">subgraph</span> <span class="ow">in</span> <span class="n">subgraph_collection</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">out_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                -------------------------</span>
<span class="s2">                </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Subgraph relationships: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Seeded size: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Representitive node: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Nodes added: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Non-subgraph hits (orphans): </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                Total nodes: </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subgraph_name</span><span class="p">,</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">relationship_count</span><span class="p">,</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">seeded_size</span><span class="p">,</span>
                           <span class="n">subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subgraph</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">seeded_size</span><span class="p">,</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">subgraph</span><span class="o">.</span><span class="n">node_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">subgraph</span><span class="o">.</span><span class="n">root_id_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                           <span class="nb">len</span><span class="p">(</span><span class="n">subgraph</span><span class="o">.</span><span class="n">root_node_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="n">report_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out_string</span><span class="p">)</span>

    <span class="c1"># FIXME: cannot json save due to recursion of objects within objects...</span>
    <span class="c1"># tools.json_save(collection_node_mapping, os.path.join(args[&#39;&lt;output_directory&gt;&#39;], &quot;GC_node_mapping&quot;))</span>

    <span class="c1"># Making a file for network visualization via Cytoscape 3.0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s2">&quot;NetworkTable.csv&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">network_table</span><span class="p">:</span>
        <span class="n">edgewriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">network_table</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">quotechar</span><span class="o">=</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">term_id</span><span class="p">,</span> <span class="n">root_id_list</span> <span class="ow">in</span> <span class="n">collection_id_mapping</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">root_id</span> <span class="ow">in</span> <span class="n">root_id_list</span><span class="p">:</span>
                <span class="n">edgewriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">term_id</span><span class="p">,</span> <span class="n">root_id</span><span class="p">])</span></div>


<div class="viewcode-block" id="find_category_subsets"><a class="viewcode-back" href="../api.html#gocats.find_category_subsets">[docs]</a><span class="k">def</span> <span class="nf">find_category_subsets</span><span class="p">(</span><span class="n">subgraph_collection</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Finds subgraphs which are subsets of other subgraphs to remove reduncancy, when specified.&quot;&quot;&quot;</span>
    <span class="n">is_subset_of</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">subgraph</span> <span class="ow">in</span> <span class="n">subgraph_collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">next_subgraph</span> <span class="ow">in</span> <span class="n">subgraph_collection</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">next_subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span> <span class="ow">and</span> <span class="n">subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">next_subgraph</span><span class="o">.</span><span class="n">root_id_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">is_subset_of</span><span class="p">[</span><span class="n">subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">next_subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">is_subset_of</span><span class="p">[</span><span class="n">subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">next_subgraph</span><span class="o">.</span><span class="n">representative_node</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">is_subset_of</span></div>


<span class="k">def</span> <span class="nf">compute_subgraph_similarity</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">tabulate</span> <span class="k">import</span> <span class="n">tabulate</span>
    <span class="n">inc_index_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">output_file</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">]</span>
    <span class="n">gocats_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;gocats_mapping&gt;&#39;</span><span class="p">])</span>
    <span class="n">other_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;other_mapping&gt;&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--id_translation&#39;</span><span class="p">]:</span>
        <span class="n">id_translation_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;--id_translation&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">id_translation_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">shared_locations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">other_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">shared_locations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">id_translation_dict</span><span class="p">:</span>
            <span class="n">go_id_string</span> <span class="o">=</span> <span class="n">id_translation_dict</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">go_id_string</span> <span class="o">=</span> <span class="n">location</span>
        <span class="n">inc_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">other_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
            <span class="n">other_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])</span>
        <span class="n">jaccard_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">other_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="n">other_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])))</span>
        <span class="n">inc_index_table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">go_id_string</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">inc_index</span><span class="p">,</span> <span class="n">jaccard_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">]),</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">other_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">])])</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">inc_index_table</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                     <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;GO term&#39;</span><span class="p">,</span> <span class="s1">&#39;Inclusion Index&#39;</span><span class="p">,</span> <span class="s1">&#39;Jaccard Index&#39;</span><span class="p">,</span> <span class="s1">&#39;GC subgraph size&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;Other subgraph size&#39;</span><span class="p">])</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;filename&gt;&#39;</span><span class="p">]),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">compute_subgraph_intersection</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">import</span> <span class="nn">pyupset</span> <span class="k">as</span> <span class="nn">pyu</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">]):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">])</span>

    <span class="n">gocats_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;gocats_mapping&gt;&#39;</span><span class="p">])</span>
    <span class="n">uniprot_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;uniprot_mapping&gt;&#39;</span><span class="p">])</span>
    <span class="n">map2slim_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;map2slim_mapping&gt;&#39;</span><span class="p">])</span>

    <span class="n">location_categories</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">uniprot_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">map2slim_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">location_categories</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">uniprot_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">set</span><span class="p">(</span><span class="n">map2slim_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())])]:</span>
        <span class="n">uniprot_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">location</span><span class="p">]</span>
    <span class="n">shared_locations</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">uniprot_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
        <span class="o">*</span><span class="p">[</span><span class="nb">set</span><span class="p">(</span><span class="n">gocats_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="nb">set</span><span class="p">(</span><span class="n">map2slim_mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">shared_locations</span><span class="p">:</span>
        <span class="n">go_id_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">location</span><span class="p">)[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">gc_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Terms&#39;</span><span class="p">:</span> <span class="n">gocats_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">]})</span>
        <span class="n">up_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Terms&#39;</span><span class="p">:</span> <span class="n">uniprot_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">]})</span>
        <span class="n">m2s_set</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Terms&#39;</span><span class="p">:</span> <span class="n">map2slim_mapping</span><span class="p">[</span><span class="n">location</span><span class="p">]})</span>
        <span class="n">set_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;GOcats&#39;</span><span class="p">:</span> <span class="n">gc_set</span><span class="p">,</span> <span class="s1">&#39;UniProt&#39;</span><span class="p">:</span> <span class="n">up_set</span><span class="p">,</span> <span class="s1">&#39;Map2Slim&#39;</span><span class="p">:</span> <span class="n">m2s_set</span><span class="p">}</span>
        <span class="n">pyuobject</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">set_dict</span><span class="p">,</span> <span class="n">unique_keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Terms&#39;</span><span class="p">])</span>
        <span class="n">pyuobject</span><span class="p">[</span><span class="s1">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">],</span> <span class="s1">&#39;CategorySubgraphIntersection_&#39;</span> <span class="o">+</span> <span class="n">go_id_string</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">categorize_dataset</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="n">loaded_gaf_array</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">parse_gaf</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;gaf_dataset&gt;&#39;</span><span class="p">])</span>
    <span class="n">mapping_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;term_mapping&gt;&#39;</span><span class="p">])</span>
    <span class="n">output_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;output_directory&gt;&#39;</span><span class="p">])</span>
    <span class="n">gaf_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;GAF_name&gt;&#39;</span><span class="p">]</span>
    <span class="n">mapped_gaf_array</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">unmapped_genes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_directory</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">loaded_gaf_array</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">mapping_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">mapped_terms</span> <span class="o">=</span> <span class="n">mapping_dict</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">mapped_terms</span><span class="p">:</span>
                <span class="n">mapped_gaf_array</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">unmapped_genes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;NO_GENE:&#39;</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unmapped_genes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">writeout_gaf</span><span class="p">(</span><span class="n">mapped_gaf_array</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">gaf_name</span><span class="p">))</span>
    <span class="n">tools</span><span class="o">.</span><span class="n">list_to_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_directory</span><span class="p">,</span> <span class="n">gaf_name</span> <span class="o">+</span> <span class="s1">&#39;_unmappedGenes&#39;</span><span class="p">),</span> <span class="n">unmapped_genes</span><span class="p">)</span>


<div class="viewcode-block" id="compare_mapping"><a class="viewcode-back" href="../api.html#gocats.compare_mapping">[docs]</a><span class="k">def</span> <span class="nf">compare_mapping</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compares the agreement in annotation assignment between a GAF produced by GOcats and another dataset, provided in</span>
<span class="sd">    csv format.&quot;&quot;&quot;</span>
    <span class="c1"># TODO: Add argumnets for output directory. Save tables and list of genes not in database in this directory.</span>
    <span class="kn">from</span> <span class="nn">tabulate</span> <span class="k">import</span> <span class="n">tabulate</span>
    <span class="kn">import</span> <span class="nn">catcompare</span>

    <span class="n">mapped_dataset_gaf_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">make_gaf_dict</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;mapped_gaf&gt;&#39;</span><span class="p">],</span> <span class="n">keys</span><span class="o">=</span><span class="s1">&#39;db_object_symbol&#39;</span><span class="p">)</span>
    <span class="n">hpa_dataset_dict</span> <span class="o">=</span> <span class="n">catcompare</span><span class="o">.</span><span class="n">make_dataset_dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;&lt;manual_dataset&gt;&#39;</span><span class="p">]),</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Supportive&#39;</span><span class="p">)</span>
    <span class="n">location_breakdown_table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="n">comparison_results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="n">gene_assignment_tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--map_manual_dataset&#39;</span><span class="p">]:</span>
        <span class="n">manual_dataset_mapping</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;--map_manual_dataset&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">manual_dataset_mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">compare_entry</span><span class="p">(</span><span class="n">object_symbol</span><span class="p">,</span> <span class="n">raw_data_go_set</span><span class="p">,</span> <span class="n">knowledgebase_go_set</span><span class="p">,</span> <span class="n">comparison_results</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">raw_data_go_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">knowledgebase_go_set</span><span class="p">)</span> <span class="o">==</span> <span class="n">raw_data_go_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span>
                <span class="n">knowledgebase_go_set</span><span class="p">):</span>  <span class="c1"># and len(raw_data_go_set.union(knowledgebase_go_set)) != 0:  EDIT should this ever happen? Correctly not-assigning non-assignments demonstrates accuracy. However these cases are non-informative.</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">object_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;complete&#39;</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data_go_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">knowledgebase_go_set</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">raw_data_go_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">knowledgebase_go_set</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">object_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_data_go_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">knowledgebase_go_set</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span>
                <span class="n">raw_data_go_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">knowledgebase_go_set</span><span class="p">)):</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">object_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;partial&#39;</span>
            <span class="k">if</span> <span class="n">knowledgebase_go_set</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">raw_data_go_set</span><span class="p">):</span>
                <span class="n">comparison_results</span><span class="p">[</span><span class="n">object_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;superset&#39;</span>
                <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">object_symbol</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inconclusive (missing annotations)&#39;</span>
            <span class="k">return</span>

    <span class="k">for</span> <span class="n">gene_name</span><span class="p">,</span> <span class="n">go_set</span> <span class="ow">in</span> <span class="n">hpa_dataset_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">gene_name</span> <span class="ow">in</span> <span class="n">mapped_dataset_gaf_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">manual_dataset_mapping</span><span class="p">:</span>  <span class="c1"># Mapping terms in the manually-annotated dataset to the user-defined categories to compare to the mapped dataset</span>
                <span class="n">old_go_set</span> <span class="o">=</span> <span class="n">go_set</span>
                <span class="n">go_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">go_term</span> <span class="ow">in</span> <span class="n">old_go_set</span><span class="p">:</span>
                    <span class="n">go_set</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">manual_dataset_mapping</span><span class="p">[</span><span class="n">go_term</span><span class="p">])</span>
                <span class="n">compare_entry</span><span class="p">(</span><span class="n">gene_name</span><span class="p">,</span> <span class="n">go_set</span><span class="p">,</span> <span class="n">mapped_dataset_gaf_dict</span><span class="p">[</span><span class="n">gene_name</span><span class="p">],</span> <span class="n">comparison_results</span><span class="p">)</span>
                <span class="n">gene_assignment_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gene_name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">go_set</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapped_dataset_gaf_dict</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]),</span>
                                               <span class="n">comparison_results</span><span class="p">[</span>
                                                   <span class="n">gene_name</span><span class="p">]))</span>  <span class="c1"># Saving gene assignments prior to set evaluation.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">compare_entry</span><span class="p">(</span><span class="n">gene_name</span><span class="p">,</span> <span class="n">go_set</span><span class="p">,</span> <span class="n">mapped_dataset_gaf_dict</span><span class="p">[</span><span class="n">gene_name</span><span class="p">],</span> <span class="n">comparison_results</span><span class="p">)</span>
                <span class="n">gene_assignment_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gene_name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">go_set</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mapped_dataset_gaf_dict</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]),</span>
                                               <span class="n">comparison_results</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comparison_results</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;not in knowledgebase&#39;</span>
            <span class="n">gene_assignment_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">gene_name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">go_set</span><span class="p">),</span> <span class="nb">set</span><span class="p">(),</span> <span class="n">comparison_results</span><span class="p">[</span><span class="n">gene_name</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--id_translation&#39;</span><span class="p">]:</span>
        <span class="n">id_translation_dict</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">json_load</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="s1">&#39;--id_translation&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">id_translation_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

    <span class="c1"># shows a breakdown of agreement per location (annoataion category)</span>
    <span class="k">for</span> <span class="n">location</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">hpa_dataset_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span> <span class="o">+</span>
                        <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">manual_dataset_mapping</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span> <span class="k">if</span> <span class="n">manual_dataset_mapping</span><span class="p">]):</span>  <span class="c1"># A flattening of the list of lists in hpa dataset dict locations. HPA dataset locaitons should be used as opposed to mapping methods&#39; locations because we want to account for ALL locations involved. These are all of the locations mapped in GO slims and in the Category file. There might be cases in which the mapping methods didnt find an assignment for a particular location in the knowledgebase, this would exclude a category from making it to this list.</span>
        <span class="n">complete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
        <span class="n">partial</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;partial&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
        <span class="n">superset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;superset&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
        <span class="n">none</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
        <span class="n">missing_annotations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inconclusive (missing annotations)&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                   <span class="n">gene_assignment_tuples</span><span class="p">))</span>
        <span class="n">not_in_knowledgebase</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not in knowledgebase&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                   <span class="n">gene_assignment_tuples</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">id_translation_dict</span><span class="p">:</span>
            <span class="n">location_name</span> <span class="o">=</span> <span class="n">id_translation_dict</span><span class="p">[</span><span class="n">location</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location_name</span> <span class="o">=</span> <span class="n">location</span>
        <span class="n">location_breakdown_table</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">[</span><span class="n">location_name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">partial</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">superset</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">none</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_annotations</span><span class="p">),</span>
             <span class="nb">len</span><span class="p">(</span><span class="n">not_in_knowledgebase</span><span class="p">)])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of genes with go location assignments per agreement type (compared with raw data)&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="n">tabulate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">location_breakdown_table</span><span class="p">),</span>
                   <span class="n">headers</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Location&#39;</span><span class="p">,</span> <span class="s1">&#39;Complete&#39;</span><span class="p">,</span> <span class="s1">&#39;Partial&#39;</span><span class="p">,</span> <span class="s1">&#39;Superset&#39;</span><span class="p">,</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;Missing Annotations&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Not in Knowledgebase&#39;</span><span class="p">]))</span>
    
    <span class="c1">#  Shows a breakdown of genes in each agreement category</span>
    <span class="n">complete</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="n">partial</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;partial&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="n">superset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;superset&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="n">no_match</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="n">missing_annotations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;inconclusive (missing annotations)&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="n">not_in_knowledgebase</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;not in knowledgebase&#39;</span><span class="p">,</span> <span class="n">gene_assignment_tuples</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;complete: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">complete</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;partial: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">partial</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;superset: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">superset</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="s1">&#39;none: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">no_match</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;missing_annotations: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_annotations</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
          <span class="s1">&#39;not in knowledgebase: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">not_in_knowledgebase</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;Total: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gene_assignment_tuples</span><span class="p">))</span>

    <span class="c1"># The following are examples mentioned in the publication</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">,</span> <span class="s2">&quot;Partial&quot;</span><span class="p">,</span> <span class="s2">&quot;----&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">partial</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;greater than&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s2">&quot;equal to&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">,</span> <span class="s2">&quot;Superset&quot;</span><span class="p">,</span> <span class="s2">&quot;----&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">superset</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">gene_tuple</span> <span class="ow">in</span> <span class="n">gene_assignment_tuples</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gene_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PSMD3&#39;</span> <span class="ow">and</span> <span class="n">gene_tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;complete&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PSMD3 IS IN COMPLETE AGREEMENT!&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gene_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PSMD3&#39;</span> <span class="ow">and</span> <span class="n">gene_tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;complete&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PSMD3 AGREEMENT IS NOT COMPLETE&quot;</span><span class="p">,</span> <span class="n">gene_tuple</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--save_assignments&#39;</span><span class="p">]:</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="s1">&#39;--save_assignments&#39;</span><span class="p">]</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">list_to_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gene_assignment_tuples</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">gene_id</span><span class="p">:</span> <span class="n">gene_id</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">docopt</span><span class="o">.</span><span class="n">docopt</span><span class="p">(</span><span class="n">__doc__</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;GOcats Version &#39;</span><span class="p">)</span><span class="o">+</span><span class="n">version</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>

      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../index.html">Contents</a>
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Eugene Hinderer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.8.
    </div>
  </body>
</html>